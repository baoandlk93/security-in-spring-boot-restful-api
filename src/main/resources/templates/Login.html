<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href='https://fonts.googleapis.com/css?family=Ubuntu:500' rel='stylesheet' type='text/css'>
<!--    <script src="https://code.jquery.com/jquery-3.7.0.js"-->
<!--            integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            background: url('http://cdn.wallpapersafari.com/13/6/Mpsg2b.jpg');
            margin: 0px;
            font-family: 'Ubuntu', sans-serif;
            background-size: 100% 110%;
        }

        h1, h2, h3, h4, h5, h6, a {
            margin: 0;
            padding: 0;
        }

        .login {
            margin: 0 auto;
            max-width: 500px;
        }

        .login-header {
            color: #fff;
            text-align: center;
            font-size: 300%;
        }

        .login-header h1 {
            text-shadow: 0px 5px 15px #000;
        }

        .login-form {
            border: .5px solid #fff;
            background: #4facff;
            border-radius: 10px;
            box-shadow: 0px 0px 10px #000;
        }

        .login-form h3 {
            text-align: left;
            margin-left: 40px;
            color: #fff;
        }

        .login-form {
            box-sizing: border-box;
            padding-top: 15px;
            padding-bottom: 10%;
            margin: 5% auto;
            text-align: center;
        }

        .login input[type="text"],
        .login input[type="password"] {
            max-width: 400px;
            width: 80%;
            line-height: 3em;
            font-family: 'Ubuntu', sans-serif;
            margin: 1em 2em;
            border-radius: 5px;
            border: 2px solid #f2f2f2;
            outline: none;
            padding-left: 10px;
        }

        .login-form input[type="button"] {
            height: 30px;
            width: 100px;
            background: #fff;
            border: 1px solid #f2f2f2;
            border-radius: 20px;
            color: slategrey;
            text-transform: uppercase;
            font-family: 'Ubuntu', sans-serif;
            cursor: pointer;
        }

        .sign-up {
            color: #f2f2f2;
            margin-left: -70%;
            cursor: pointer;
            text-decoration: underline;
        }

        .no-access {
            color: #E86850;
            margin: 20px 0px 20px -57%;
            text-decoration: underline;
            cursor: pointer;
        }

        .try-again {
            color: #f2f2f2;
            text-decoration: underline;
            cursor: pointer;
        }

        /*Media Querie*/
        @media only screen and (min-width: 150px) and (max-width: 530px) {
            .login-form h3 {
                text-align: center;
                margin: 0;
            }

            .sign-up, .no-access {
                margin: 10px 0;
            }

            .login-button {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>

<div class="login">
    <div class="login-header">
        <h1>Login</h1>
    </div>
    <div class="login-form">
        <h3>Username:</h3>
        <input type="text" id="username" placeholder="Username"/><br>
        <h3>Password:</h3>
        <input type="password" id="password" placeholder="Password"/>
        <br>
        <input type="button" id="submit" value="Login" class="login-button"/>
        <br>
        <a class="sign-up">Sign Up!</a>
        <br>
        <h6 class="no-access">Can't access your account?</h6>
    </div>
</div>
<script>
    const Toast = Swal.mixin({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
    })


    $(document).ready(function () {
        $("#submit").on("click", function () {
            const username = $("#username").val();
            const password = $("#password").val();
            const user = {
                username: username,
                password: password
            }
            console.log(user);

            $.ajax({
                url: "http://localhost:8080/api/auth/login",
                type: "POST",
                data: JSON.stringify(user),
                contentType: 'application/json',
                success: (response) => {
                    $.cookie(response.cookie.name,response.cookie.value);
                    localStorage.setItem(response.cookie.name,response.cookie.value);
                    sessionStorage.setItem(response.cookie.name,response.cookie.value);
                    Toast.fire({
                        icon: 'success',
                        title: 'Signed in successfully'
                    })
                    // Xử lý thành công
                },
                error: function (xhr, status, error) {
                    console.log(xhr);
                    console.log(status);
                    console.log(error);
                    let timerInterval
                    Swal.fire({
                        title: 'Auto close alert!',
                        html: 'I will close in <b></b> milliseconds.',
                        timer: 1500,
                        timerProgressBar: true,
                        didOpen: () => {
                            Swal.showLoading()
                            const b = Swal.getHtmlContainer().querySelector('b')
                            timerInterval = setInterval(() => {
                                b.textContent = Swal.getTimerLeft()
                            }, 100)
                        },
                        willClose: () => {
                            clearInterval(timerInterval)
                        }
                    }).then((result) => {
                        /* Read more about handling dismissals below */
                        if (result.dismiss === Swal.DismissReason.timer) {
                            window.location.reload();
                        }
                    })
                    // Xử lý lỗi
                }
            });
        });
    });
</script>
</body>
</html>